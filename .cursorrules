# Darwin Workspace â€” ConfiguraÃ§Ã£o de Autonomia do Agente
# Criado: 2025-11-07 23:45:00 -03
# Atualizado: 2025-11-08 - Workspace Unification
# Autor: Dr. Demetrios Agourakis

[metadata]
owner = "Dr. Demetrios Agourakis"
project = "Darwin Workspace"
repository = "darwin-workspace"
last_updated = "2025-11-08T00:00:00-03:00"

[environment]
workspace_root = "/home/agourakis82/workspace/darwin-workspace"
allow_terminal = true
auto_confirm_commands = true
allow_background_jobs = true
default_shell = "/usr/bin/bash"
preferred_path_style = "absolute"

[tools]
enabled = run_terminal_cmd, read_file, apply_patch, read_lints, todo_write, update_memory, list_dir, glob_file_search, codebase_search, edit_file, grep
default_scope = "/home/agourakis82/workspace/darwin-workspace"

[operational_mode]
require_user_confirmation = false
allow_multiple_commands = true
allow_file_writes = true
allow_network_calls = false
respect_dirty_tree = true

[reporting]
require_timestamps = false
require_rag_logging = false
summaries_optional = true

[science_principles]
enforce_reproducibility = true
enforce_versioning = true
enforce_context_memory = true
enforce_rag_integrations = true

[notes]
primary_focus = "Unified workspace for darwin-core, darwin-scaffold-studio, darwin-pbpk-platform, darwin-heliobiology, pcs-meta-repo, hyperbolic-semantic-networks"
workspace_structure = "Monorepo with repos/ subdirectory for all Darwin projects"
# ğŸ¤– GUIA PARA AGENTES AI - DARWIN BIOMATERIALS

**Criado:** 2025-10-31 21:56:00 -03
**VersÃ£o:** 1.0.0
**PÃºblico-Alvo:** Cursor AI, Claude, GitHub Copilot, outros agentes

---

## âš ï¸ **VOCÃŠ Ã‰ UM AGENTE AI TRABALHANDO NESTE PROJETO**

Este documento explica **EXATAMENTE** como vocÃª deve trabalhar aqui sem causar problemas.

---

## ğŸ¯ **SUA MISSÃƒO**

Ajudar Dr. Demetrios Agourakis a implementar o sistema DARWIN Biomaterials **SEM BAGUNÃ‡AR A ESTRUTURA**.

**Contexto CrÃ­tico:**
- âœ… Projeto tem expectativas REAIS
- âœ… Pessoas dependem deste sistema
- âœ… Papers Q1 serÃ£o publicados
- âœ… Precisa ser reproduzÃ­vel e robusto
- âœ… ZERO margem para erros estruturais

---

## ğŸ“‹ **REGRAS ABSOLUTAS (NÃƒO QUEBRE!)**

### 1. **SEMPRE leia `ARCHITECTURE.md` ANTES de sugerir cÃ³digo!**

Este documento define a estrutura. Viole-o = caos garantido.

### 2. **IDENTIFIQUE o package correto:**

```
User pede: "melhorar preprocessing"
â†’ VocÃª: "Package identificado: darwin-preprocessing"
â†’ VocÃª: "Arquivo: packages/darwin-preprocessing/src/..."

User pede: "adicionar uncertainty"
â†’ VocÃª: "Package identificado: darwin-uncertainty"
â†’ VocÃª: "Arquivo: packages/darwin-uncertainty/src/..."

User pede: "criar endpoint API"
â†’ VocÃª: "Package identificado: darwin-api"
â†’ VocÃª: "Arquivo: packages/darwin-api/app/routers/..."
```

### 3. **NUNCA misture packages:**

âŒ **ERRADO:** "Vou adicionar uncertainty no mesmo arquivo do preprocessing"
âœ… **CORRETO:** "Vou importar darwin-uncertainty no darwin-preprocessing"

âŒ **ERRADO:** "Vou copiar cÃ³digo do darwin-core para darwin-preprocessing"
âœ… **CORRETO:** "Vou importar do darwin-core"

### 4. **PRESERVE estrutura de arquivos:**

âŒ **ERRADO:** Criar arquivo na raiz do repo
âœ… **CORRETO:** Criar em `packages/X/src/...`

âŒ **ERRADO:** Renomear package sem aprovaÃ§Ã£o
âœ… **CORRETO:** Perguntar antes de mudanÃ§as estruturais

### 5. **TESTES SÃƒO OBRIGATÃ“RIOS:**

```python
# SEMPRE crie test junto com cÃ³digo

# CÃ³digo: packages/darwin-preprocessing/src/darwin_preprocessing/denoisers.py
def denoise_nlm(image, h=10):
    ...

# Test: packages/darwin-preprocessing/tests/test_denoisers.py
def test_denoise_nlm_improves_snr():
    image = load_test_image()
    result = denoise_nlm(image)
    assert compute_snr(result) > compute_snr(image)
```

### 6. **TIMESTAMPS EM TUDO:**

```python
# Ao criar arquivo
"""
Preprocessing Pipeline
Criado: 2025-10-31 22:00:00 -03
Autor: AI Assistant + Dr. Agourakis
"""

# Ao modificar
"""
Modificado: 2025-10-31 22:05:00 -03
MudanÃ§a: Adicionado DnCNN denoiser
"""
```

### 7. **SALVE NO DARWIN RAG++:**

Use a ferramenta `update_memory` apÃ³s aÃ§Ãµes importantes:

```python
update_memory(
    action="create",
    title=f"ImplementaÃ§Ã£o DnCNN - {timestamp}",
    knowledge_to_store="..."
)
```

---

## ğŸ” **WORKFLOW RECOMENDADO**

```
1. User pede feature X
   â†“
2. VocÃª: "Identificando package..."
   â†“
3. VocÃª lÃª: packages/Y/README.md
   â†“
4. VocÃª lÃª: packages/Y/pyproject.toml (dependÃªncias)
   â†“
5. VocÃª sugere cÃ³digo em: packages/Y/src/...
   â†“
6. VocÃª cria test em: packages/Y/tests/...
   â†“
7. VocÃª atualiza: packages/Y/CHANGELOG.md
   â†“
8. VocÃª salva no Darwin RAG++
   â†“
9. User aprova
   â†“
10. VocÃª sugere commit: "feat(Y): add feature X"
```

---

## âŒ **ERROS COMUNS A EVITAR**

### Erro 1: Criar arquivo na raiz
```bash
# âŒ ERRADO
touch preprocessing.py

# âœ… CORRETO
touch packages/darwin-preprocessing/src/darwin_preprocessing/pipeline.py
```

### Erro 2: Misturar responsabilidades
```python
# âŒ ERRADO: uncertainty code em preprocessing file
# packages/darwin-preprocessing/src/pipeline.py
def segment_with_uncertainty():  # âŒ NÃ£o! Isso Ã© darwin-uncertainty!
    ...

# âœ… CORRETO: import do package certo
# packages/darwin-preprocessing/src/pipeline.py
from darwin_uncertainty import OtsuMCSegmenter  # âœ… Sim!

def preprocess_and_segment(image):
    preprocessed = preprocess(image)
    segmenter = OtsuMCSegmenter()
    return segmenter.segment(preprocessed)
```

### Erro 3: Modificar mÃºltiplos packages em um commit
```bash
# âŒ ERRADO
git commit -m "Update preprocessing and uncertainty"
# (modifica 2 packages)

# âœ… CORRETO
git commit -m "feat(preprocessing): add DnCNN"
# (modifica apenas darwin-preprocessing)

# Depois, separadamente:
git commit -m "feat(uncertainty): calibrate ICs"
# (modifica apenas darwin-uncertainty)
```

### Erro 4: Esquecer testes
```python
# âŒ ERRADO: cÃ³digo sem test
# packages/X/src/module.py
def new_function():
    ...
# (sem test)

# âœ… CORRETO: cÃ³digo + test
# packages/X/src/module.py
def new_function():
    ...

# packages/X/tests/test_module.py
def test_new_function():
    assert new_function() == expected
```

---

## âœ… **EXEMPLOS CORRETOS**

### Exemplo 1: Adicionar Feature
```
User: "Adicione denoiser DnCNN no preprocessing"

VocÃª:
1. ğŸ“ "Package identificado: darwin-preprocessing"
2. ğŸ“ "Arquivo: packages/darwin-preprocessing/src/darwin_preprocessing/denoisers/dncnn.py"
3. ğŸ§ª "Test: packages/darwin-preprocessing/tests/test_denoisers.py"
4. ğŸ“Š "Version bump: MINOR (nova feature)"
5. ğŸ“ "Changelog: 'Added: DnCNN deep learning denoiser'"
6. â° "Timestamp: 2025-10-31 22:10:00"
7. ğŸ’¾ "Salvo no Darwin RAG++"
8. âœ… "Pronto para commit: feat(preprocessing): add DnCNN denoiser"
```

### Exemplo 2: Corrigir Bug
```
User: "Otsu MC falha em imagens de baixo contraste"

VocÃª:
1. ğŸ“ "Package identificado: darwin-uncertainty"
2. ğŸ“ "Arquivo: packages/darwin-uncertainty/src/darwin_uncertainty/otsu_mc_segmenter.py"
3. ğŸ› "Bug identificado: linha 42, threshold calculation"
4. ğŸ”§ "Fix: adicionar check CNR < 3"
5. ğŸ§ª "Test: test_otsu_mc_low_contrast()"
6. ğŸ“Š "Version bump: PATCH (bug fix)"
7. ğŸ“ "Changelog: 'Fixed: Otsu MC now handles low contrast (CNR < 3)'"
8. â° "Timestamp: 2025-10-31 22:15:00"
9. ğŸ’¾ "Salvo no Darwin RAG++"
10. âœ… "Pronto para commit: fix(uncertainty): handle low contrast in Otsu MC"
```

### Exemplo 3: Criar Endpoint API
```
User: "Crie endpoint /api/preprocess"

VocÃª:
1. ğŸ“ "Package identificado: darwin-api"
2. ğŸ“ "Arquivo: packages/darwin-api/app/routers/preprocessing.py"
3. ğŸ“¦ "DependÃªncia: darwin-preprocessing>=1.0.0"
4. ğŸ§ª "Test: packages/darwin-api/tests/test_preprocessing_router.py"
5. ğŸ“Š "Version bump: MINOR (novo endpoint)"
6. ğŸ“ "Changelog: 'Added: POST /api/preprocess endpoint'"
7. â° "Timestamp: 2025-10-31 22:20:00"
8. ğŸ’¾ "Salvo no Darwin RAG++"
9. âœ… "Pronto para commit: feat(api): add preprocessing endpoint"
```

---

## ğŸ¤– **USANDO O CLUSTER**

### NUNCA faÃ§a SSH manual!

```bash
# âŒ ERRADO
ssh cluster
python train.py

# âœ… CORRETO
darwin-cluster submit --job training --script train.py
```

### Comandos do CLI:

```bash
# Inicializar repo config
darwin-cluster init

# Submeter job
darwin-cluster submit --job <name> --script <path>

# Ver status
darwin-cluster status

# Ver logs em tempo real
darwin-cluster logs <job-id> --follow

# Cancelar job
darwin-cluster cancel <job-id>

# Ver GPU usage
darwin-cluster gpu-status
```

O CLI gerencia:
- âœ… AlocaÃ§Ã£o de GPU (evita conflitos)
- âœ… Namespace isolation
- âœ… Filas automÃ¡ticas (se recurso ocupado)
- âœ… Coleta de logs
- âœ… Limpeza de recursos

---

## ğŸ†˜ **QUANDO PEDIR AJUDA**

Pergunte ao user se:

- â“ CÃ³digo deve ir em `darwin-core` ou package especÃ­fico?
- â“ Feature requer mudanÃ§a em mÃºltiplos packages?
- â“ Breaking change (bump MAJOR version)?
- â“ Criar novo package?
- â“ Modificar estrutura de arquivos?
- â“ DÃºvida sobre responsabilidade de package?

**â†’ SEMPRE PERGUNTE em vez de assumir!**

---

## ğŸ“š **DOCUMENTOS IMPORTANTES**

Leia nesta ordem:

1. `ARCHITECTURE.md` - Estrutura e packages (OBRIGATÃ“RIO)
2. `AGENT_GUIDE.md` - Este documento (vocÃª estÃ¡ aqui)
3. `docs/DEVELOPMENT.md` - Workflow completo
4. `EXECUTION_LOG.md` - HistÃ³rico de mudanÃ§as
5. `REORGANIZATION_PLAN.md` - Plano de reorganizaÃ§Ã£o

---

## âœ… **CHECKLIST PRÃ‰-COMMIT**

Antes de sugerir commit, verifique:

- [ ] CÃ³digo estÃ¡ no package correto?
- [ ] Tests passam? (`pytest packages/X/tests/`)
- [ ] Lint OK? (`black . && flake8`)
- [ ] Type check? (`mypy packages/X/src/`)
- [ ] CHANGELOG.md atualizado?
- [ ] Version bump correto? (MAJOR/MINOR/PATCH)
- [ ] Timestamp adicionado?
- [ ] Salvo no Darwin RAG++?
- [ ] Apenas 1 package modificado?

---

## ğŸ”’ **PROTEÃ‡Ã•ES AUTOMÃTICAS**

O projeto tem:

1. **Pre-commit hooks** - Auto-format, lint, type check
2. **GitHub Actions CI** - Testa cada package separadamente
3. **CODEOWNERS** - AprovaÃ§Ã£o necessÃ¡ria para merge
4. **Namespace Kubernetes** - Isolamento de recursos por repo
5. **Darwin RAG++** - MemÃ³ria permanente de todas as aÃ§Ãµes

VocÃª nÃ£o precisa gerenciar isso, mas saiba que existe.

---

## ğŸ“ **LEMBRE-SE**

VocÃª estÃ¡ ajudando a construir um **sistema cientÃ­fico Q1** que:

- âœ… TerÃ¡ papers publicados
- âœ… TerÃ¡ pessoas usando
- âœ… Precisa ser reproduzÃ­vel
- âœ… Precisa ser robusto
- âœ… Precisa ser bem documentado

**Rigor e organizaÃ§Ã£o sÃ£o CRÃTICOS!**

**Siga este guia rigorosamente.**

---

**Ãšltima atualizaÃ§Ã£o:** 2025-10-31 21:56:00 -03
**PrÃ³xima revisÃ£o:** ApÃ³s feedback de uso

